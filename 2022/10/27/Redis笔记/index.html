<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Redis学习 | 侬的杂货铺</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Redis笔记0. 学习资料1231.redis官网：redis.io2.redis中文网：www.redis.cn3.在官网上下载Redis  centos下安装python3和pip3：https:&#x2F;&#x2F;cloud.tencent.com&#x2F;developer&#x2F;article&#x2F;1693084 pip3不可用的解决情况：https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_42185136&#x2F;ar">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis学习">
<meta property="og:url" content="https://kdhello07.github.io/2022/10/27/Redis%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="侬的杂货铺">
<meta property="og:description" content="Redis笔记0. 学习资料1231.redis官网：redis.io2.redis中文网：www.redis.cn3.在官网上下载Redis  centos下安装python3和pip3：https:&#x2F;&#x2F;cloud.tencent.com&#x2F;developer&#x2F;article&#x2F;1693084 pip3不可用的解决情况：https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_42185136&#x2F;ar">
<meta property="og:locale">
<meta property="og:image" content="c:\Users\helloworld\AppData\Roaming\Typora\typora-user-images\image-20211201193620995.png">
<meta property="og:image" content="c:\Users\helloworld\AppData\Roaming\Typora\typora-user-images\image-20211201200451105.png">
<meta property="og:image" content="c:\Users\helloworld\AppData\Roaming\Typora\typora-user-images\image-20211201200714760.png">
<meta property="og:image" content="c:\Users\helloworld\AppData\Roaming\Typora\typora-user-images\image-20211201201519607.png">
<meta property="og:image" content="c:\Users\helloworld\AppData\Roaming\Typora\typora-user-images\image-20211205162549921.png">
<meta property="article:published_time" content="2022-10-26T16:00:00.000Z">
<meta property="article:modified_time" content="2024-01-26T20:05:07.705Z">
<meta property="article:author" content="Kevin he">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:\Users\helloworld\AppData\Roaming\Typora\typora-user-images\image-20211201193620995.png">
  
    <link rel="alternate" href="/atom.xml" title="侬的杂货铺" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">侬的杂货铺</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">技术、阅读、分享</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Suche"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://kdhello07.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Redis笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/10/27/Redis%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2022-10-26T16:00:00.000Z" itemprop="datePublished">2022-10-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/">技术学习</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Redis学习
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Redis笔记"><a href="#Redis笔记" class="headerlink" title="Redis笔记"></a>Redis笔记</h1><h2 id="0-学习资料"><a href="#0-学习资料" class="headerlink" title="0. 学习资料"></a>0. 学习资料</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.redis官网：redis.io</span><br><span class="line">2.redis中文网：www.redis.cn</span><br><span class="line">3.在官网上下载Redis</span><br></pre></td></tr></table></figure>

<p>centos下安装python3和pip3：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1693084">https://cloud.tencent.com/developer/article/1693084</a></p>
<p>pip3不可用的解决情况：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42185136/article/details/90636750">https://blog.csdn.net/weixin_42185136/article/details/90636750</a></p>
<p>linux与python3安装redis：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1592173">https://cloud.tencent.com/developer/article/1592173</a></p>
<h2 id="1-Nosql概述"><a href="#1-Nosql概述" class="headerlink" title="1. Nosql概述"></a>1. Nosql概述</h2><h3 id="1-基础介绍"><a href="#1-基础介绍" class="headerlink" title="1. 基础介绍"></a>1. 基础介绍</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">为什么要用Nosql</span></span><br><span class="line">	用户的个人信息，社交网络，地理位置，用户自己产生的数据，用户日志等等爆发式增长，这时候我们就需要使用Nosql数据库，Nosql可以很好的处理这些情况	</span><br><span class="line"><span class="meta prompt_">	</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">什么是Nosql （Not Only sql）</span></span><br><span class="line">	泛指非关系型数据库，数据的存储没有固定的格式，不需要特别的操作就可以横向扩展，使用键值对来进行控制</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Nosql特点</span></span><br><span class="line">	1.方便扩展（数据之间没有关系，很好扩展）</span><br><span class="line">	2.大数据量高性能（Redis一秒写8万次，读取11万次，Nosql缓存记录级，是一种细粒度的缓存，性能会比较高）</span><br><span class="line">	3.数据类型是多样型的（不需要事先设计数据库，随取随用）</span><br><span class="line">	4.传统的数据库和Nosql区别</span><br><span class="line">		传统的RBBMS:</span><br><span class="line">			- 结构化组织</span><br><span class="line">			- SQL</span><br><span class="line">			- 数据和关系都存在单独的表中</span><br><span class="line">			- 数据操作 数据定义语言</span><br><span class="line">			- 严格一致性</span><br><span class="line">			- 基础的事务</span><br><span class="line">		Nosql:</span><br><span class="line">			- 不仅仅是数据</span><br><span class="line">			- 没有固定的查询语言</span><br><span class="line">			- 键值对查询，列查询，文档存储，图形数据库（社交关系）</span><br><span class="line">			- 最终一致性</span><br><span class="line">			- CAP原理和BASE原理</span><br><span class="line">			- 高性能，高可用，高扩展性</span><br><span class="line">		</span><br></pre></td></tr></table></figure>

<h3 id="2-nosql的四大分类"><a href="#2-nosql的四大分类" class="headerlink" title="2. nosql的四大分类"></a>2. nosql的四大分类</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.KV键值对：</span><br><span class="line">	新浪：Redis</span><br><span class="line">	美团：Redis+Tair</span><br><span class="line">	阿里、百度：Redis+memecache</span><br><span class="line">2.文档型数据库(bson格式和json一样)</span><br><span class="line">	MongoDB:是一个基于分布式文件存储的数据库，c++编写，主要用来处理大量的文档</span><br><span class="line">	MongoDB是一个介于关系型数据库和非关系型数据库中间的产品，是非关系型数据库中功能最丰富的，最像关系型数据库的</span><br><span class="line">3.列存储数据库</span><br><span class="line">	HBase</span><br><span class="line">	分布式文件系统</span><br><span class="line">4.图关系数据库</span><br><span class="line">	他不是存图形，放的是关系，比如朋友圈社交网络，广告推荐</span><br><span class="line">	Neo4j,InfoGrid</span><br></pre></td></tr></table></figure>

<h2 id="2-Redis入门"><a href="#2-Redis入门" class="headerlink" title="2. Redis入门"></a>2. Redis入门</h2><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Redis是什么</span></span><br><span class="line">	Redis(==Remote Dictionary Server)即远程字典服务。免费和开源，最热门的Nosql技术之一</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Redis能干嘛</span></span><br><span class="line">	1.内存存储，持久化，内存中是断电即失，所以说持久化很重要（rdb,aof）</span><br><span class="line">	2.效率高，可以用于告诉缓存</span><br><span class="line">	3.发布订阅系统</span><br><span class="line">	4.地图信息分析</span><br><span class="line">	5.计时器，计数器（浏览量）</span><br><span class="line"><span class="meta prompt_">	</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Redis特性：</span></span><br><span class="line">	1.多样的数据类型</span><br><span class="line">	2.持久化</span><br><span class="line">	3.集群</span><br><span class="line">	4.事务</span><br></pre></td></tr></table></figure>

<h3 id="2-windows安装"><a href="#2-windows安装" class="headerlink" title="2. windows安装"></a>2. windows安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.下载安装包</span><br><span class="line">2.解压</span><br><span class="line">3.打开服务端，不要关闭</span><br><span class="line">4.打开客户端</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\helloworld\AppData\Roaming\Typora\typora-user-images\image-20211201193620995.png" alt="image-20211201193620995"></p>
<h3 id="3-Linux安装"><a href="#3-Linux安装" class="headerlink" title="3. Linux安装"></a>3. Linux安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">1.下载安装包 redis-6.2.6.tar.gz</span><br><span class="line">2.在/opt目录下新建文件夹Redis</span><br><span class="line">3.将安装包放到Redis目录下</span><br><span class="line">4.解压安装包：   &gt;&gt;&gt;# tar -zxvf redis-6.2.6.tar.gz</span><br><span class="line">5.进入解压后的目录redis-6.2.6，我们可以看到一个redis.conf文件</span><br><span class="line">6.安装gcc环境：  &gt;&gt;&gt;# yum install gcc-c++</span><br><span class="line">7.使用make命令： &gt;&gt;&gt;# make</span><br><span class="line">8.redis的默认安装路径 /usr/local/bin</span><br><span class="line">9.进入到/usr/local目录 &gt;&gt;&gt;# cd /usr/local</span><br><span class="line">10.将redis.conf配置文件拷贝到当前local目录下的bin &gt;&gt;&gt;# cp /opt/Redis/redis-6.2.6/redis.conf bin</span><br><span class="line">11.redis默认不是后台启动的，修改配置文件 &gt;&gt;&gt;# vim redis.conf</span><br><span class="line">12.将daemonize属性修改为yes,输入:wq保存退出</span><br><span class="line">13.启动redis服务 [root@study bin]# redis-server redis.conf     #通过指定的配置文件启动</span><br><span class="line">14.开启客户端[root@study bin]# redis-cli</span><br><span class="line">15.测试是否开启成功</span><br><span class="line">    127.0.0.1:6379&gt; ping</span><br><span class="line">    PONG</span><br><span class="line">    127.0.0.1:6379&gt; set msg hello    （设置值）</span><br><span class="line">    OK</span><br><span class="line">    127.0.0.1:6379&gt; get msg        	  （获取值）</span><br><span class="line">    &quot;hello&quot;</span><br><span class="line">    127.0.0.1:6379&gt; keys *             （查看所有的key）</span><br><span class="line">	1) &quot;msg&quot;</span><br><span class="line">16.查看redis进程是否开启</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">新开一个端口来</span></span><br><span class="line">    [root@study bin]# ps -ef|grep redis</span><br><span class="line">    root      15432      1  0 20:17 ?        00:00:02 redis-server 127.0.0.1:6379</span><br><span class="line">    root      15486  10405  0 20:22 pts/1    00:00:00 redis-cli</span><br><span class="line">    root      15838  15763  0 20:24 pts/3    00:00:00 grep --color=auto redis</span><br><span class="line">17.如何关闭Redis服务呢？shutdown</span><br><span class="line">	127.0.0.1:6379&gt; shutdown  #关闭redis服务器</span><br><span class="line">	not connected&gt; exit       #退出</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\helloworld\AppData\Roaming\Typora\typora-user-images\image-20211201200451105.png" alt="image-20211201200451105"></p>
<p><img src="C:\Users\helloworld\AppData\Roaming\Typora\typora-user-images\image-20211201200714760.png" alt="image-20211201200714760"></p>
<p><img src="C:\Users\helloworld\AppData\Roaming\Typora\typora-user-images\image-20211201201519607.png" alt="image-20211201201519607"></p>
<h3 id="4-测试性能"><a href="#4-测试性能" class="headerlink" title="4. 测试性能"></a>4. 测试性能</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-benchmark是一个压力测试工具。官方自带的性能测试工具</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt;<span class="comment"># redis-benchmark -h localhost -p 6379 -c 100 -n 10000</span></span></span><br></pre></td></tr></table></figure>

<h3 id="5-基础的知识和命令"><a href="#5-基础的知识和命令" class="headerlink" title="5. 基础的知识和命令"></a>5. 基础的知识和命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用<span class="keyword">select</span>切换数据库</span></span><br><span class="line">	redis有16个数据库,默认的使用第0个数据库</span><br><span class="line">    可以使用select进行切换</span><br><span class="line">        127.0.0.1:6379&gt; select 3</span><br><span class="line">        OK</span><br><span class="line">        127.0.0.1:6379[3]&gt; DBSIZE</span><br><span class="line">        (integer) 0</span><br><span class="line">        127.0.0.1:6379[3]&gt; select 0</span><br><span class="line">        OK</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用DBSIZE查看数据库大小</span></span><br><span class="line">	127.0.0.1:6379&gt; DBSIZE</span><br><span class="line">   	(integer) 5</span><br><span class="line">   	</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用keys *查看所有键</span></span><br><span class="line">	127.0.0.1:6379&gt; select 3</span><br><span class="line">    OK</span><br><span class="line">    127.0.0.1:6379[3]&gt; DBSIZE</span><br><span class="line">    (integer) 0</span><br><span class="line">    127.0.0.1:6379[3]&gt; set msg hello</span><br><span class="line">    OK</span><br><span class="line">    127.0.0.1:6379[3]&gt; DBSIZE</span><br><span class="line">    (integer) 1</span><br><span class="line">    127.0.0.1:6379[3]&gt; set name xiaoming</span><br><span class="line">    OK</span><br><span class="line">    127.0.0.1:6379[3]&gt; DBSIZE</span><br><span class="line">    (integer) 2</span><br><span class="line">    127.0.0.1:6379[3]&gt; keys *</span><br><span class="line">    1) &quot;name&quot;</span><br><span class="line">    2) &quot;msg&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">清空当前数据库 FLUSHDB</span></span><br><span class="line">	127.0.0.1:6379[3]&gt; FLUSHDB</span><br><span class="line"><span class="meta prompt_">	</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">清空所有数据库 FLUSHDB</span></span><br><span class="line">	127.0.0.1:6379[3]&gt; FLUSHALL</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Redis是单线程的</span></span><br><span class="line">	Redis是基于内存操作的，CPU不是Redis性能瓶颈，Redis的瓶颈是根据机器的内存和网络带宽，既然可以使用单线程来实现，就使用了单线程。</span><br><span class="line"><span class="meta prompt_">	</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Redis使用单线程为什么还这么快</span></span><br><span class="line">    redis是c语言写的</span><br><span class="line">	误区1：高性能的服务器一定是多线程的</span><br><span class="line">	误区2：多线程（cpu上下文切换需要资源）一定比单线程块</span><br><span class="line">	先去cpu &gt; 内存 &gt; 硬盘的速度</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">核心：redis是将所有的数据放在内存中的，所以说使用单线程去操作效率是最高的，多线程（cpu上下文切换是一个耗时的操作！！！），对于内存系统来说，没有上下文切换效率就是最快的，多次读写都是在一个cpu上，在内存情况下，这个就是最佳的</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Redis五大数据类型"><a href="#3-Redis五大数据类型" class="headerlink" title="3.Redis五大数据类型"></a>3.Redis五大数据类型</h2><h3 id="1-基本介绍"><a href="#1-基本介绍" class="headerlink" title="1. 基本介绍"></a>1. 基本介绍</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。 它支持多种类型的数据结构，如 字符串（strings）， 散列（hashes）， 列表（lists）， 集合（sets）， 有序集合（sorted sets） 与范围查询， bitmaps， hyperloglogs 和 地理空间（geospatial） 索引半径查询。 Redis 内置了 复制（replication），LUA脚本（Lua scripting）， LRU驱动事件（LRU eviction），事务（transactions） 和不同级别的 磁盘持久化（persistence）， 并通过 Redis哨兵（Sentinel）和自动 分区（Cluster）提供高可用性（high availability）。</span><br></pre></td></tr></table></figure>

<h3 id="2-Redis-key-含基本命令"><a href="#2-Redis-key-含基本命令" class="headerlink" title="2. Redis-key(含基本命令)"></a>2. Redis-key(含基本命令)</h3><blockquote>
<p>有keys *、EXISTS key、move key db、EXPIRE key seconds、ttl key、type key</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">keys *		[查看所有key]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; keys *</span><br><span class="line">(empty array)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">set</span> key value	[设置值]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; set name xiaoming</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[3]&gt; set age 19</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[3]&gt; keys *</span><br><span class="line">1) &quot;age&quot;</span><br><span class="line">2) &quot;name&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">EXISTS key		[判断当前key是否存在]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; EXISTS name</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379[3]&gt; EXISTS nameone</span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">move key db [将该键对应的键值对移到另外一个数据库中去]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; move name 1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379[3]&gt; keys *</span><br><span class="line">1) &quot;age&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">EXPIRE key seconds [设置该键的过期时间]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; EXPIRE age 5</span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ttl key	[查看当前key的剩余时间]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; ttl age</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379[3]&gt; set name xiaoming</span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">type</span> key	[查看当前key的类型]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; type name</span><br><span class="line">string</span><br></pre></td></tr></table></figure>

<h3 id="3-String（字符串）"><a href="#3-String（字符串）" class="headerlink" title="3. String（字符串）"></a>3. String（字符串）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">set</span> key value</span></span><br><span class="line">127.0.0.1:6379[3]&gt; set key1 val1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[3]&gt; set key2 val2</span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">append key value	[在原有key对应的值后面附加值]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; APPEND key1 hello</span><br><span class="line">(integer) 9</span><br><span class="line">127.0.0.1:6379[3]&gt; get key1</span><br><span class="line">&quot;val1hello&quot;</span><br><span class="line">127.0.0.1:6379[3]&gt; append key1 hello</span><br><span class="line">(integer) 14</span><br><span class="line">127.0.0.1:6379[3]&gt; append key1 hello&quot;</span><br><span class="line">Invalid argument(s)</span><br><span class="line">127.0.0.1:6379[3]&gt; append key1 &quot;hello&quot;</span><br><span class="line">(integer) 19</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">strlen key		[查看当前key对应的值的长度]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; strlen key1</span><br><span class="line">(integer) 19</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这里注意 中文字占3个字节</span></span><br><span class="line">127.0.0.1:6379[3]&gt; append key1 &quot;我&quot;</span><br><span class="line">(integer) 22</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################</span></span></span><br><span class="line">127.0.0.1:6379[3]&gt; set views 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[3]&gt; get views</span><br><span class="line">&quot;0&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">incr key		[将当前键对应的<span class="built_in">integer</span>值进行加1]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; incr views</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379[3]&gt; incr views</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379[3]&gt; get views</span><br><span class="line">&quot;2&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">decr key 		[将当前键对应的<span class="built_in">integer</span>值进行减1]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; decr views</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379[3]&gt; decr views</span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">incrby key increment  [设置步长 将当前键对应的<span class="built_in">integer</span>值进行加incrment大小]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; INCRBY views 5</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379[3]&gt; INCRBY views 5</span><br><span class="line">(integer) 10</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">decrby key decrment	[将当前键对应的<span class="built_in">integer</span>值进行减decrment大小]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; DECRBY views 5</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379[3]&gt; DECRBY views 5</span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################</span></span></span><br><span class="line">127.0.0.1:6379[3]&gt; set name &quot;helloworld&quot;</span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">getrange key start end  [截取字符串下标从start开始，到end中间的子串，包括首尾的内容]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; GETRANGE name 0 3</span><br><span class="line">&quot;hell&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">getrange key 0 -1		[获取整个字符串，-1表示到最后一个]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; GETRANGE name 0 -1</span><br><span class="line">&quot;helloworld&quot;</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379[3]&gt; set str abcdefg</span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SETRANGE key offset value		[将value的值放到原来的value中，会根据大小进行一个覆盖]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; SETRANGE str 2 hello</span><br><span class="line">(integer) 7</span><br><span class="line">127.0.0.1:6379[3]&gt; get str</span><br><span class="line">&quot;abhello&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注意即便之前存在有这个键，也不会报错，只是将原来的内容进行一个覆盖</span></span><br><span class="line">127.0.0.1:6379[3]&gt; set str abcdefg</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[3]&gt; get str</span><br><span class="line">&quot;abcdefg&quot;</span><br><span class="line">127.0.0.1:6379[3]&gt; SETRANGE str 2 he</span><br><span class="line">(integer) 7</span><br><span class="line">127.0.0.1:6379[3]&gt; get str</span><br><span class="line">&quot;abheefg&quot;</span><br><span class="line">127.0.0.1:6379[3]&gt; set str abcdefg</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[3]&gt; SETRANGE str 2 hehhhhhhhhh</span><br><span class="line">(integer) 13</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################</span></span></span><br><span class="line">设置值时添加过期时间</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">setex key seconds value   [在设置该键值对时并设置过期时间]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; setex name 10 xiaoming</span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">setnx key value   [这个会在分布式锁中常用。只有在该键不存在的情况下才能设置成功，返回1，否则失败，返回0]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; setnx stu neu</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379[3]&gt; get stu</span><br><span class="line">&quot;neu&quot;</span><br><span class="line">127.0.0.1:6379[3]&gt; setnx stu pku</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379[3]&gt; get stu</span><br><span class="line">&quot;neu&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">MSET key value [key value...]		[设置多个键值对]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; mset k1 v1 k2 v2 k3 v3</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[3]&gt; keys *</span><br><span class="line">1) &quot;k2&quot;</span><br><span class="line">2) &quot;k3&quot;</span><br><span class="line">3) &quot;k1&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mget key [key...] 					[获取多个键的值]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; mget k1 k2 k3</span><br><span class="line">1) &quot;v1&quot;</span><br><span class="line">2) &quot;v2&quot;</span><br><span class="line">3) &quot;v3&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">msetnx key value [key value...]     [用法同setnx。这是一个原子性的操作，要不全部成功，要不全部失败]</span></span><br><span class="line">127.0.0.1:6379[3]&gt; MSETNX k1 v1 k4 v4</span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################</span></span></span><br><span class="line">设置对象</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置一个user:1对象，值为json对象</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这里的key是一个巧妙的设计，user:&#123;<span class="built_in">id</span>&#125;:&#123;filed&#125;,如此设计在redis中是可以的</span></span><br><span class="line">127.0.0.1:6379&gt; set user:1 &#123;name:hello,age:19&#125;</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get user:1</span><br><span class="line">&quot;&#123;name:hello,age:19&#125;&quot;</span><br><span class="line">127.0.0.1:6379&gt; set stu &#123;name:hello,age:19&#125;</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get stu</span><br><span class="line">&quot;&#123;name:hello,age:19&#125;&quot;</span><br><span class="line">127.0.0.1:6379&gt; set user:2 &#123;name:haha,age:20&#125;</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get user</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; get user:2</span><br><span class="line">&quot;&#123;name:haha,age:20&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">也可以这样进行操作</span></span><br><span class="line">127.0.0.1:6379&gt; mset user:1:name hello user:1:age 21</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get user:1</span><br><span class="line">&quot;&#123;name:hello,age:19&#125;&quot;</span><br><span class="line">127.0.0.1:6379&gt; mget user:1:name user:1:age</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;21&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################</span></span></span><br><span class="line">getset命令</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">getset key value		[如果该key之前不存在就返回nil,若存在就返回该键对应的值，并且将该键对应的值进行修改为后面的这个value值]</span></span><br><span class="line">127.0.0.1:6379&gt; getset db redis</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; get db</span><br><span class="line">&quot;redis&quot;</span><br><span class="line">127.0.0.1:6379&gt; getset db mongodb</span><br><span class="line">&quot;redis&quot;</span><br><span class="line">127.0.0.1:6379&gt; get db</span><br><span class="line">&quot;mongodb&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>String类似的使用场景：value除了是我们的字符串还可以是我们的数字！</p>
<ul>
<li>计数器</li>
<li>统计多单位的数量</li>
<li>粉丝数</li>
<li>对象缓存存储</li>
</ul>
</blockquote>
<h3 id="4-List（列表）"><a href="#4-List（列表）" class="headerlink" title="4. List（列表）"></a>4. List（列表）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在redis里面，我们可以把list实现栈、队列、阻塞队列</span></span><br><span class="line">注意所有的list命令都是用L(l)开头的。redis不区分大小写命令</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">########################################################################</span></span></span><br><span class="line">插入值</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">lpush key element [element...]  在头部依次插入多个值，有点类似于栈</span></span><br><span class="line">127.0.0.1:6379&gt; LPUSH list 0 1 2 3</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 3</span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;1&quot;</span><br><span class="line">4) &quot;0&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;1&quot;</span><br><span class="line">4) &quot;0&quot;</span><br><span class="line">127.0.0.1:6379&gt; lpush list 4</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) &quot;4&quot;</span><br><span class="line">2) &quot;3&quot;</span><br><span class="line">3) &quot;2&quot;</span><br><span class="line">4) &quot;1&quot;</span><br><span class="line">5) &quot;0&quot;</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">rpush key element [element...]   在尾部依次插入多个值，有点类似于队列</span></span><br><span class="line">127.0.0.1:6379&gt; rpush list2 0 1 2 3 4</span><br><span class="line">(integer) 5</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">lrange key start stop		[通过指定区间获取值，包括start和stop两端的值]</span></span><br><span class="line">127.0.0.1:6379&gt; lrange list2 0 -1</span><br><span class="line">1) &quot;0&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">3) &quot;2&quot;</span><br><span class="line">4) &quot;3&quot;</span><br><span class="line">5) &quot;4&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">########################################################################</span></span></span><br><span class="line">移除值</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">lpop key [count]		[从头部开始移除元素，默认是移除一个，也可以指定移除count个]</span></span><br><span class="line">127.0.0.1:6379&gt; lpop list 1</span><br><span class="line">1) &quot;8&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line"> 1) &quot;7&quot;</span><br><span class="line"> 2) &quot;6&quot;</span><br><span class="line"> 3) &quot;5&quot;</span><br><span class="line"> 4) &quot;4&quot;</span><br><span class="line"> 5) &quot;3&quot;</span><br><span class="line"> 6) &quot;2&quot;</span><br><span class="line"> 7) &quot;1&quot;</span><br><span class="line"> 8) &quot;0&quot;</span><br><span class="line"> 9) &quot;9&quot;</span><br><span class="line">10) &quot;10&quot;</span><br><span class="line">11) &quot;11&quot;</span><br><span class="line">12) &quot;12&quot;</span><br><span class="line">127.0.0.1:6379&gt; lpop list 3</span><br><span class="line">1) &quot;7&quot;</span><br><span class="line">2) &quot;6&quot;</span><br><span class="line">3) &quot;5&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) &quot;4&quot;</span><br><span class="line">2) &quot;3&quot;</span><br><span class="line">3) &quot;2&quot;</span><br><span class="line">4) &quot;1&quot;</span><br><span class="line">5) &quot;0&quot;</span><br><span class="line">6) &quot;9&quot;</span><br><span class="line">7) &quot;10&quot;</span><br><span class="line">8) &quot;11&quot;</span><br><span class="line">9) &quot;12&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">rpop key [count]		[从尾部开始移除元素，默认是移除一个，也可以指定移除count个]</span></span><br><span class="line">127.0.0.1:6379&gt; rpop list 3</span><br><span class="line">1) &quot;12&quot;</span><br><span class="line">2) &quot;11&quot;</span><br><span class="line">3) &quot;10&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">########################################################################</span></span></span><br><span class="line">根据下标获取值</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) &quot;4&quot;</span><br><span class="line">2) &quot;3&quot;</span><br><span class="line">3) &quot;2&quot;</span><br><span class="line">4) &quot;1&quot;</span><br><span class="line">5) &quot;0&quot;</span><br><span class="line">6) &quot;9&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">lindex key index		[根据下标获取值，index从0开始]</span></span><br><span class="line">127.0.0.1:6379&gt; LINDEX list 2</span><br><span class="line">&quot;2&quot;</span><br><span class="line">127.0.0.1:6379&gt; LINDEX list 4</span><br><span class="line">&quot;0&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">########################################################################</span></span></span><br><span class="line">获取list中的长度</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">llen key</span></span><br><span class="line">127.0.0.1:6379&gt; llen list</span><br><span class="line">(integer) 6</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">########################################################################</span></span></span><br><span class="line">移除list中指定的元素</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) &quot;4&quot;</span><br><span class="line">2) &quot;4&quot;</span><br><span class="line">3) &quot;3&quot;</span><br><span class="line">4) &quot;2&quot;</span><br><span class="line">5) &quot;1&quot;</span><br><span class="line">6) &quot;0&quot;</span><br><span class="line">7) &quot;9&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">lrem key count element [从头部开始查找，移除指定的元素值，count指定要移除掉多少个]</span></span><br><span class="line">127.0.0.1:6379&gt; lrem list 1 2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; lrem list 2 4</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">3) &quot;0&quot;</span><br><span class="line">4) &quot;9&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">########################################################################</span></span></span><br><span class="line">ltrim 修建，将list进行截断，类似于取子串</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; lpush list &quot;hello&quot; hello1 hello2 hello3</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) &quot;hello3&quot;</span><br><span class="line">2) &quot;hello2&quot;</span><br><span class="line">3) &quot;hello1&quot;</span><br><span class="line">4) &quot;hello&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ltrim key start stop		[截取下标从start开始，到stop结束的元素赋给key]</span></span><br><span class="line">127.0.0.1:6379&gt; ltrim list 1 2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) &quot;hello2&quot;</span><br><span class="line">2) &quot;hello1&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">########################################################################</span></span></span><br><span class="line">从尾部移除一个元素，并添加到一个list的头部</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) &quot;hello5&quot;</span><br><span class="line">2) &quot;hello4&quot;</span><br><span class="line">3) &quot;hello3&quot;</span><br><span class="line">4) &quot;hello2&quot;</span><br><span class="line">5) &quot;hello1&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">rpoplpush <span class="built_in">source</span> destination		[指从<span class="built_in">source</span>列表的尾部移除一个元素，并将该元素插入到destination的头部，注意<span class="built_in">source</span>和destination可以是同一个]</span></span><br><span class="line">127.0.0.1:6379&gt; rpoplpush list mylist</span><br><span class="line">&quot;hello1&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrange mylist 0 -1</span><br><span class="line">1) &quot;hello1&quot;</span><br><span class="line">127.0.0.1:6379&gt; rpoplpush list list</span><br><span class="line">&quot;hello2&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) &quot;hello2&quot;</span><br><span class="line">2) &quot;hello5&quot;</span><br><span class="line">3) &quot;hello4&quot;</span><br><span class="line">4) &quot;hello3&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">########################################################################</span></span></span><br><span class="line">lset设置值，类似于更新操作</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用exists来查询该列表是否存在</span></span><br><span class="line">127.0.0.1:6379&gt; EXISTS list</span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">lset key index element		[更新list中指定下标的值，如果该list不存在会报错]</span></span><br><span class="line">127.0.0.1:6379&gt; lset list 0 hello</span><br><span class="line">(error) ERR no such key</span><br><span class="line">127.0.0.1:6379&gt; lpush list val1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; lset list 0 hello</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 0</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">########################################################################</span></span></span><br><span class="line">在list中pviot元素的前面或者后面插入value值</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">127.0.0.1:6379&gt; lpush list world china chain</span><br><span class="line">(integer) 4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">linsert BEFORE|AFTER pviot value		[在list中pviot元素的前面或者后面插入value值，注意如果有多个的话，只插入从头部开始遇到的第一个pviot元素值]</span></span><br><span class="line">127.0.0.1:6379&gt; LINSERT list before world japan</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) &quot;chain&quot;</span><br><span class="line">2) &quot;china&quot;</span><br><span class="line">3) &quot;japan&quot;</span><br><span class="line">4) &quot;world&quot;</span><br><span class="line">5) &quot;hello&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">########################################################################</span></span></span><br><span class="line">只有在list存在时，lpushx才能插入成功</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; FLUSHALL</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lpushx list 1 2 3 4 5</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; lpushx list 1 2 3 4 5 6 7 8 </span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">(empty array)</span><br><span class="line">127.0.0.1:6379&gt; lpush list 1 2 3</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; lpushx list 4 5 6</span><br><span class="line">(integer) 6</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
<ul>
<li>它实际上是一个链表，可以从头插入，也可以从尾部插入</li>
<li>如果key不存在，就创建新的列表</li>
<li>如果key存在，就新增内容</li>
<li>如果移除了所有值，就是一个空列表，也代表不存在，此时就又需要重新创建列表了</li>
<li>在两边插入或者改动值，效率最高，中间元素，相对来说效率会低一点</li>
</ul>
</blockquote>
<h3 id="5-set-集合"><a href="#5-set-集合" class="headerlink" title="5. set (集合)"></a>5. set (集合)</h3><blockquote>
<p>set中的值是不能重复的，无序的集合</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sadd key member [member...]    [往<span class="built_in">set</span>集合中添加一个或多个元素]</span></span><br><span class="line">127.0.0.1:6379&gt; sadd myset hello</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd myset world adele typora</span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">smembers key		[查看<span class="built_in">set</span>集合中的所有元素]</span></span><br><span class="line">127.0.0.1:6379&gt; smembers myset</span><br><span class="line">1) &quot;typora&quot;</span><br><span class="line">2) &quot;hello&quot;</span><br><span class="line">3) &quot;adele&quot;</span><br><span class="line">4) &quot;world&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sismember key member		[判断某一个值是不是在<span class="built_in">set</span>集合中]</span></span><br><span class="line">127.0.0.1:6379&gt; SISMEMBER myset hello</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; SISMEMBER myset helllotwo</span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################################</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">scard key			[获取<span class="built_in">set</span>集合中的内容元素个数]</span></span><br><span class="line">127.0.0.1:6379&gt; scard myset</span><br><span class="line">(integer) 4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">srem key member [member...]	[移除<span class="built_in">set</span>集合中的一个或多个元素]</span></span><br><span class="line">127.0.0.1:6379&gt; SREM myset hello world</span><br><span class="line">(integer) 2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">srandmember key count		[随机获取到<span class="built_in">set</span>集合中的count个元素]</span></span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset 1</span><br><span class="line">1) &quot;haha&quot;</span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset 1</span><br><span class="line">1) &quot;xixi&quot;</span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset 1</span><br><span class="line">1) &quot;world&quot;</span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset 2</span><br><span class="line">1) &quot;typora&quot;</span><br><span class="line">2) &quot;xixi&quot;</span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset 2</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;hehe&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################################</span></span></span><br><span class="line">随机删除元素</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">spop key count		[随即删除<span class="built_in">set</span>集合中指定个数的元素]</span></span><br><span class="line">127.0.0.1:6379&gt; spop myset 1</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">smove <span class="built_in">source</span> destination member	[将<span class="built_in">source</span>集合中指定的元素member移到目标集合中去]</span></span><br><span class="line">127.0.0.1:6379&gt; smove myset myset2 adele</span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################################################################</span></span></span><br><span class="line">求解集合之间的差集、交集、并集</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; sadd set1 a b c</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; sadd set2 b c d</span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sdiff key1 [key2...]   [求解差集。key1-key2.即只有key1集合中有，其他集合中没有的元素]</span>   </span><br><span class="line">127.0.0.1:6379&gt; sdiff set1 set2</span><br><span class="line">1) &quot;a&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sinter key [key]		[求解交集]</span></span><br><span class="line">127.0.0.1:6379&gt; SINTER set1 set2</span><br><span class="line">1) &quot;b&quot;</span><br><span class="line">2) &quot;c&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sunion key [key]		[求解并集]</span></span><br><span class="line">127.0.0.1:6379&gt; SUNION set1 set2</span><br><span class="line">1) &quot;a&quot;</span><br><span class="line">2) &quot;b&quot;</span><br><span class="line">3) &quot;d&quot;</span><br><span class="line">4) &quot;c&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>set集合的应用<ul>
<li>共同关注</li>
</ul>
</li>
</ul>
<p>	</p>
</blockquote>
<h3 id="6-Hash-哈希"><a href="#6-Hash-哈希" class="headerlink" title="6. Hash(哈希)"></a>6. Hash(哈希)</h3><p>Map集合，key  Map 这时候这个value值是一个map集合。本质和string没有太多区别</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hset key field value [field value...]		[往<span class="built_in">hash</span>中设置一个或多个值]</span></span><br><span class="line">127.0.0.1:6379&gt; HSET myhash name xiaoming age 19</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; HSET myhash name zhangsan  age 20</span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hkeys key		[获取该<span class="built_in">hash</span>中所有的字段]</span></span><br><span class="line">127.0.0.1:6379&gt; hkeys myhash</span><br><span class="line">1) &quot;name&quot;</span><br><span class="line">2) &quot;age&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hget key field		[获取该<span class="built_in">hash</span>中该字段对应的值]</span></span><br><span class="line">127.0.0.1:6379&gt; hget myhash name</span><br><span class="line">&quot;zhangsan&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hmset key field value [field value...]		[往<span class="built_in">hash</span>中设置一个或多个值]</span></span><br><span class="line">127.0.0.1:6379&gt; HMSET myhash city beijing  country China</span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hgetall key		[获取该<span class="built_in">hash</span>中所有字段与字段值]</span></span><br><span class="line">127.0.0.1:6379&gt; HGETALL myhash</span><br><span class="line">1) &quot;name&quot;</span><br><span class="line">2) &quot;zhangsan&quot;</span><br><span class="line">3) &quot;age&quot;</span><br><span class="line">4) &quot;20&quot;</span><br><span class="line">5) &quot;city&quot;</span><br><span class="line">6) &quot;beijing&quot;</span><br><span class="line">7) &quot;country&quot;</span><br><span class="line">8) &quot;China&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##############################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hdel key field [field...]		[删除<span class="built_in">hash</span>中指定的字段，删除后字段对应的值就也没有了]</span></span><br><span class="line">127.0.0.1:6379&gt; hdel myhash name city</span><br><span class="line">(integer) 2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##############################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hlen key		[获取<span class="built_in">hash</span>中有多少个field]</span></span><br><span class="line">127.0.0.1:6379&gt; HLEN myhash</span><br><span class="line">(integer) 2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##############################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hexists key field		[判断<span class="built_in">hash</span>中某个字段是否存在]</span></span><br><span class="line">127.0.0.1:6379&gt; HEXISTS myhash age</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; HEXISTS myhash name</span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##############################################################################</span></span></span><br><span class="line">127.0.0.1:6379&gt; HGETALL myhash</span><br><span class="line">1) &quot;age&quot;</span><br><span class="line">2) &quot;20&quot;</span><br><span class="line">3) &quot;country&quot;</span><br><span class="line">4) &quot;China&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hkeys key			[获取<span class="built_in">hash</span>中所有的field]</span></span><br><span class="line">127.0.0.1:6379&gt; hkeys myhash</span><br><span class="line">1) &quot;age&quot;</span><br><span class="line">2) &quot;country&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hvals key			[获取<span class="built_in">hash</span>中所有的value]</span></span><br><span class="line">127.0.0.1:6379&gt; hvals myhash</span><br><span class="line">1) &quot;20&quot;</span><br><span class="line">2) &quot;China&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##############################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hsetnx key field value		[如果该字段不存在就设置该字段和值，否则就不允许设置]</span></span><br><span class="line">127.0.0.1:6379&gt; hsetnx myhash age 20</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hsetnx myhash age 20</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; hsetnx myhash age 2</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; HGETALL myhash</span><br><span class="line">1) &quot;age&quot;</span><br><span class="line">2) &quot;20&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##############################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hincreby key field incrment	[将<span class="built_in">hash</span>中指定字段的值按照指定的步长进行自增]</span></span><br><span class="line">127.0.0.1:6379&gt; HINCRBY myhash age 3</span><br><span class="line">(integer) 23</span><br><span class="line">127.0.0.1:6379&gt; HINCRBY myhash age 3</span><br><span class="line">(integer) 26</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>hash变更的应用。尤其是用户信息的保存,经常变动的数据。hset user name xxx age xx</li>
<li>hash更适合于对象的存储，String更加适合于字符串存储</li>
</ul>
</blockquote>
<h3 id="7-Zset-有序集合"><a href="#7-Zset-有序集合" class="headerlink" title="7. Zset(有序集合)"></a>7. Zset(有序集合)</h3><p>在set的基础上，增加了一个值，set k1 v1 	zset k1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">zadd key score member [score member...]		[往集合中添加一个元素或多个元素]</span></span><br><span class="line">127.0.0.1:6379&gt; zadd myset 1 one</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ZADD myset 3 three 2 two</span><br><span class="line">(integer) 2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">获取集合中指定范围的元素</span></span><br><span class="line">127.0.0.1:6379&gt; ZRANGE myset 0 -1</span><br><span class="line">1) &quot;one&quot;</span><br><span class="line">2) &quot;two&quot;</span><br><span class="line">3) &quot;three&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">降序</span></span><br><span class="line">127.0.0.1:6379&gt; ZREVRANGE salary 0 -1 withscores</span><br><span class="line">1) &quot;xiaoming&quot;</span><br><span class="line">2) &quot;5000&quot;</span><br><span class="line">3) &quot;xiaoyang&quot;</span><br><span class="line">4) &quot;500&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##############################################################################</span></span></span><br><span class="line">排序如何实现</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">往zset中添加多个元素</span></span><br><span class="line">127.0.0.1:6379&gt; zadd salary 2500 xiaohong 5000 xiaoming 500 xiaoyang</span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">zrangebyscore key min max [withscores]		[获取zset中score值在min到max之间的元素，升序排列]</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-inf表示最小值，+inf表示最大值</span></span><br><span class="line">127.0.0.1:6379&gt; ZRANGEbyscore salary -inf +inf</span><br><span class="line">1) &quot;xiaoyang&quot;</span><br><span class="line">2) &quot;xiaohong&quot;</span><br><span class="line">3) &quot;xiaoming&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">withcores 是指在输出时也输出scores的值</span></span><br><span class="line">127.0.0.1:6379&gt; ZRANGEbyscore salary -inf +inf withscores</span><br><span class="line">1) &quot;xiaoyang&quot;</span><br><span class="line">2) &quot;500&quot;</span><br><span class="line">3) &quot;xiaohong&quot;</span><br><span class="line">4) &quot;2500&quot;</span><br><span class="line">5) &quot;xiaoming&quot;</span><br><span class="line">6) &quot;5000&quot;</span><br><span class="line">127.0.0.1:6379&gt; ZRANGEbyscore salary 300 1000</span><br><span class="line">1) &quot;xiaoyang&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这表示输出score值在 300&lt;=score&lt;=500之间的元素</span></span><br><span class="line">127.0.0.1:6379&gt; ZRANGEbyscore salary 300 500</span><br><span class="line">1) &quot;xiaoyang&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这表示输出score值在 300&lt;=score&lt;500之间的元素</span></span><br><span class="line">127.0.0.1:6379&gt; ZRANGEbyscore salary 300 (500</span><br><span class="line">(empty array)</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ZRANGEbyscore salary -inf +inf withscores limit 1 2</span><br><span class="line">1) &quot;xiaohong&quot;</span><br><span class="line">2) &quot;2500&quot;</span><br><span class="line">3) &quot;xiaoming&quot;</span><br><span class="line">4) &quot;5000&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ZREVRANGEBYSCORE这是降序排列</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##############################################################################</span></span></span><br><span class="line">删除zset中指定的元素</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">zrem key member [member...]		[删除zset中指定的一个或多个元素]</span></span><br><span class="line">127.0.0.1:6379&gt; ZREM salary xiaohong</span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##############################################################################</span></span></span><br><span class="line">获取有序集合中的个数</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">zcard key		[获取有序集合中的个数]</span></span><br><span class="line">127.0.0.1:6379&gt; zcard salary</span><br><span class="line">(integer) 2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##############################################################################</span></span></span><br><span class="line">127.0.0.1:6379&gt; ZREVRANGE salary 0 -1 withscores</span><br><span class="line">1) &quot;xiaoming&quot;</span><br><span class="line">2) &quot;5000&quot;</span><br><span class="line">3) &quot;xiaobai&quot;</span><br><span class="line">4) &quot;2000&quot;</span><br><span class="line">5) &quot;xiaoliu&quot;</span><br><span class="line">6) &quot;1000&quot;</span><br><span class="line">7) &quot;xiaoyang&quot;</span><br><span class="line">8) &quot;500&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">zcount key min max			[获取指定区间的个数]</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1000&lt;=score&lt;=2000</span></span><br><span class="line">127.0.0.1:6379&gt; zcount salary 1000 2000</span><br><span class="line">(integer) 2</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1000&lt;=score&lt;2000</span></span><br><span class="line">127.0.0.1:6379&gt; zcount salary 1000 (2000</span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##############################################################################</span></span></span><br><span class="line">按照zset集合中member的字典来进行排序</span><br><span class="line">127.0.0.1:6379&gt; zadd zset 0 a 0 aa 0 abc 0 apple 0 b 0 c 0 d 0 d1 0 dd 0 dobble 0 z 0 z1</span><br><span class="line">(integer) 12</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">zrangebylex key min max [LIMIT offset count]</span> </span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYLEX zset - +</span><br><span class="line"> 1) &quot;a&quot;</span><br><span class="line"> 2) &quot;aa&quot;</span><br><span class="line"> 3) &quot;abc&quot;</span><br><span class="line"> 4) &quot;apple&quot;</span><br><span class="line"> 5) &quot;b&quot;</span><br><span class="line"> 6) &quot;c&quot;</span><br><span class="line"> 7) &quot;d&quot;</span><br><span class="line"> 8) &quot;d1&quot;</span><br><span class="line"> 9) &quot;dd&quot;</span><br><span class="line">10) &quot;dobble&quot;</span><br><span class="line">11) &quot;z&quot;</span><br><span class="line">12) &quot;z1&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>zset的应用场景：存储班级成绩，工资表排序，带权重进行判断，排行榜，取top n方法</li>
</ul>
</blockquote>
<h2 id="4-三种特殊数据类型"><a href="#4-三种特殊数据类型" class="headerlink" title="4.三种特殊数据类型"></a>4.三种特殊数据类型</h2><h3 id="1-geospatial-地理位置"><a href="#1-geospatial-地理位置" class="headerlink" title="1.  geospatial(地理位置)"></a>1.  geospatial(地理位置)</h3><p>微信的定位，附近的人，打车距离计算</p>
<p>Redis中的geo，这个功能可以推算地理位置的信息，两地之间的距离，方圆几里的人</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##################################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">GEOADD key longitude latitude member [longitude latitude member ...]</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">有效的经度从-180度到180度。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">有效的纬度从-85.05112878度到85.05112878度。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">当坐标位置超出上述指定范围时，该命令将会返回一个错误。</span></span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 116.40 39.90 beijing 121.47 31.23 shanghai</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 106.50 29.53 chongqing</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 114.05 29.53 shenzhen</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 120.16 30.24 hangzhou</span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##################################################################################</span></span></span><br><span class="line">获得当前定位</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">GEOPOS key member [member ...]		[获取指定城市的经度和维度]</span></span><br><span class="line">127.0.0.1:6379&gt; GEOPOS china:city beijing shanghai shenzhen</span><br><span class="line">1) 1) &quot;116.39999896287918091&quot;</span><br><span class="line">   2) &quot;39.90000009167092543&quot;</span><br><span class="line">2) 1) &quot;121.47000163793563843&quot;</span><br><span class="line">   2) &quot;31.22999903975783553&quot;</span><br><span class="line">3) 1) &quot;114.04999762773513794&quot;</span><br><span class="line">   2) &quot;29.52999957900659211&quot;</span><br><span class="line">   </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##################################################################################</span></span></span><br><span class="line">返回两个位置之间的距离</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">GEODIST key member1 member2 [unit]</span></span><br><span class="line">127.0.0.1:6379&gt; GEODIST china:city beijing shanghai m</span><br><span class="line">&quot;1067378.7564&quot;</span><br><span class="line">127.0.0.1:6379&gt; GEODIST china:city beijing shanghai km</span><br><span class="line">&quot;1067.3788&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##################################################################################</span></span></span><br><span class="line">搜索附近的人，以给定的经纬度为中心，半径为radius内的人</span><br><span class="line">前提是所有的数据已经录入</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">GEORADIUS key longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count]</span></span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 30 500 km </span><br><span class="line">1) &quot;chongqing&quot;</span><br><span class="line">2) &quot;shenzhen&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##################################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">GEORADIUSBYMEMBER key member radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count]</span></span><br><span class="line">以给定的位置为中心，找出半径为radius内的位置或人</span><br><span class="line">前提是所有的数据已经录入</span><br><span class="line">127.0.0.1:6379&gt; GEORADIUSBYMEMBER china:city beijing 1100 km</span><br><span class="line">1) &quot;beijing&quot;</span><br><span class="line">2) &quot;shanghai&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##################################################################################</span></span></span><br><span class="line">返回对应位置的geohash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">GEOHASH key member [member ...]</span></span><br><span class="line">127.0.0.1:6379&gt; GEOHASH china:city beijing shanghai shenzhen</span><br><span class="line">1) &quot;wx4fbxxfke0&quot;</span><br><span class="line">2) &quot;wtw3sj5zbj0&quot;</span><br><span class="line">3) &quot;wt1pgrb8tw0&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><font color='red'>geo底层的实现的原理是zset,因此可以使用操作zset的方式来操作geo中的key</font></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">对上面geo中的数据进行操作</span></span><br><span class="line">127.0.0.1:6379&gt; zrange china:city 0 -1</span><br><span class="line">1) &quot;chongqing&quot;</span><br><span class="line">2) &quot;shenzhen&quot;</span><br><span class="line">3) &quot;hangzhou&quot;</span><br><span class="line">4) &quot;shanghai&quot;</span><br><span class="line">5) &quot;beijing&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除其中一个元素</span></span><br><span class="line">127.0.0.1:6379&gt; zrem china:city beijing</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

<h3 id="2-hyperloglog"><a href="#2-hyperloglog" class="headerlink" title="2. hyperloglog"></a>2. hyperloglog</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">基数统计</span><br><span class="line">（1，3，5，7，8，7）</span><br><span class="line">（1，3，5，7，8）</span><br><span class="line">基数——就是不重复的元素，上面这两个集合的基数就为5，可以接受误差</span><br><span class="line">Redis2.8.9就推出了Hyperloglog数据结构</span><br><span class="line">Redis Hyperloglog 基数统计算法</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">优点：占用的内存是固定，2^64不同的元素的统计，只需要12KB内存，如果从内存角度来进行比较的话，hyperloglog是首选。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">缺点：会有一定的错误率（0.81%），可忽略不计</span></span><br><span class="line">网页的UV(一个人访问一个网站多次，但是还是算作一个人)</span><br><span class="line">传统的方式是使用set来保存用户的id,然后进行统计</span><br><span class="line">这个方式如果保存大量的用户id,就会比较麻烦，目的是为了计数，而不是保存用户id.</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将指定的元素添加到hyperloglog中</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">pfadd key element [element...]</span></span><br><span class="line">127.0.0.1:6379&gt; pfadd mykey a b c d e f g h</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfadd mykey a b c d e f g</span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">统计指定的hyperloglog中元素的基数</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">当参数为一个key时,返回存储在HyperLogLog结构体的该变量的近似基数，如果该变量不存在,则返回0.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">当参数为多个key时，返回这些HyperLogLog并集的近似基数，这个值是将所给定的所有key的HyperLoglog结构合并到一个临时的HyperLogLog结构中计算而得到的.</span></span><br><span class="line">pfcount key [key...]</span><br><span class="line">127.0.0.1:6379&gt; pfcount mykey</span><br><span class="line">(integer) 8</span><br><span class="line">127.0.0.1:6379&gt; pfadd mykey1 a b c d e f g w a a a </span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfcount mykey1</span><br><span class="line">(integer) 8</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">PFMERGE destkey sourcekey [sourcekey ...]  [合并任意组的基数中的hyperloglog到一个新的里面去统计]</span></span><br><span class="line">127.0.0.1:6379&gt; pfmerge myset2 mykey mykey1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; pfcount myset2</span><br><span class="line">(integer) 9</span><br></pre></td></tr></table></figure>

<h3 id="3-Bitmaps"><a href="#3-Bitmaps" class="headerlink" title="3. Bitmaps"></a>3. Bitmaps</h3><p><font color='red'>模式：使用 bitmap 实现用户上线次数统计</font></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">位存储</span></span><br><span class="line">统计用户信息，活跃，不活跃，登录，未登录，打卡!两个状态的，都可以使用Bitmaps!</span><br><span class="line"></span><br><span class="line">Bitmaps位图，数据结构！都是操作二进制位来进行记录，就只有0和1两种状态</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置值</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SETBIT key offset value</span></span><br><span class="line">127.0.0.1:6379&gt; SETBIT sign 1 0</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 2 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 3 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 4 0</span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">获取值，查看某一天是否打卡</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">GETBIT key offset</span></span><br><span class="line">127.0.0.1:6379&gt; getbit sign 2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 5 1</span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">统计操作，统计打卡的天数</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">BITCOUNT sign [start stop]</span></span><br><span class="line">127.0.0.1:6379&gt; BITCOUNT sign</span><br><span class="line">(integer) 3</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="5-事务"><a href="#5-事务" class="headerlink" title="5.事务"></a>5.事务</h2><blockquote>
<p><font color='red'>redis单条命令保证原子性，但是事务不保证原子性</font></p>
</blockquote>
<blockquote>
<p>redis事务的本质：一组命令的集合，一个事务中的所有命令都会被序列化，在事务执行过程中，会按照顺序执行，一次性，顺序性，排他性。执行一系列的命令</p>
</blockquote>
<blockquote>
<p>redis事务中没有隔离级别的概念</p>
<p>所有的命令在事务中，并没有直接被执行，只有发起执行命令的时候才会执行！Exec</p>
</blockquote>
<blockquote>
<ul>
<li>redis的事务：<ol>
<li>开启事务（multi）</li>
<li>命令入队（）</li>
<li>执行事务（exec）</li>
</ol>
</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开启事务</span></span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">命令入队</span></span><br><span class="line">127.0.0.1:6379(TX)&gt; set key1 val1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; set key2 val2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; get key1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; get key2</span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行事务</span></span><br><span class="line">127.0.0.1:6379(TX)&gt; exec</span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">3) &quot;val1&quot;</span><br><span class="line">4) &quot;val2&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>放弃事务（discard）</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; set key1 val1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; set key2 val2</span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">放弃事务</span></span><br><span class="line">127.0.0.1:6379(TX)&gt; discard</span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">则进队的那些命令都没有执行</span></span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>编译型异常（代码有问题！命令有错），事务中所有的命令都不会被执行</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; clear</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k3 v3</span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">编译型异常</span></span><br><span class="line">127.0.0.1:6379(TX)&gt; getsetss k3</span><br><span class="line">(error) ERR unknown command `getsetss`, with args beginning with: `k3`, </span><br><span class="line">127.0.0.1:6379(TX)&gt; set k4 v4</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; exec</span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>运行时异常（如1&#x2F;0）,如果事务队列中存在语法性错误，那么其他命令是可以正常执行的，错误命令抛出异常</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set k1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; incr k1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k3 v3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; get k2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; get k3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; get k1</span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">运行型异常，虽然第一条命令运行异常，但是其他命令正常执行</span></span><br><span class="line">127.0.0.1:6379(TX)&gt; exec</span><br><span class="line">1) (error) ERR value is not an integer or out of range</span><br><span class="line">2) OK</span><br><span class="line">3) OK</span><br><span class="line">4) &quot;v2&quot;</span><br><span class="line">5) &quot;v3&quot;</span><br><span class="line">6) &quot;v1&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>&#x3D;&#x3D;<font color='red'>监控：watch</font>&#x3D;&#x3D; （面试常问）<ul>
<li>悲观锁：<ul>
<li>很悲观，认为任务什么时候都会出问题，无论做什么都会加锁</li>
</ul>
</li>
<li>乐观锁：<ul>
<li>很乐观，认为什么时候都会出问题，无论做什么都不会加锁！更新数据的时候去判断一下，在此期间是否有人修改过这个数据</li>
<li>获取version</li>
<li>更新的时候比较version</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<blockquote>
<p>Redis监控测试：</p>
</blockquote>
<p>正常执行成功的情况：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set money 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set out 0</span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">watch key [key...]		[对一些key进行监视]</span></span><br><span class="line">127.0.0.1:6379&gt; watch money</span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开启事务</span></span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">命令入队</span></span><br><span class="line">127.0.0.1:6379(TX)&gt; decrby money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; INCRBY out 20</span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行事务</span></span><br><span class="line">127.0.0.1:6379(TX)&gt; exec</span><br><span class="line">1) (integer) 80</span><br><span class="line">2) (integer) 20</span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试多线程修改值，使用watch可以当做redis的乐观锁操作！</p>
</blockquote>
<p><font color='red'>#这是在A客户端操作</font></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set money 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set out 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; watch money</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; decrby money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; incrby money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; exec	#在执行之前，另外一个线程修改了我们的值，就会导致事务执行失败</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; get money</span><br><span class="line">&quot;1000&quot;</span><br></pre></td></tr></table></figure>

<p><font color='red'>#这是在B客户端操作</font></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get money</span><br><span class="line">&quot;100&quot;</span><br><span class="line">127.0.0.1:6379&gt; get out</span><br><span class="line">&quot;0&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在A客户端执行<span class="built_in">exec</span>之前，执行下面的命令，就会出现这种情况</span></span><br><span class="line">127.0.0.1:6379&gt; set money 1000</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; get money</span><br><span class="line">&quot;1000&quot;</span><br></pre></td></tr></table></figure>

<p>处理上面问题的方式：就是解锁后再执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">unwatch	[如果发现事务执行失败，就先解锁，再监视，之后再执行]</span></span><br><span class="line">127.0.0.1:6379&gt; unwatch    </span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; watch money</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; decrby money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; incrby out 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; exec</span><br><span class="line">1) (integer) 980</span><br><span class="line">2) (integer) 20</span><br></pre></td></tr></table></figure>

<h2 id="6-Jedis"><a href="#6-Jedis" class="headerlink" title="6. Jedis"></a>6. Jedis</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们要使用java来操作redis,就需要用到</span></span><br><span class="line">是Redis官方推荐的Java连接开发工具，使用Java操作redis中间件，需要对jedis非常熟悉</span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试</p>
</blockquote>
<ol>
<li><p>创建maven项目，导入对应的依赖包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--导入jedis包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--导入fastjson--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.78<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编码测试</p>
<ul>
<li>连接数据库</li>
<li>操作命令</li>
<li>断开连接</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//1.new Jedis对象即可</span></span><br><span class="line">    Jedis jedis=<span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">    <span class="comment">//jedis所有的命令就是我们之前学习的所有指令，每一个指令都是以方法来进行操作</span></span><br><span class="line">    System.out.println(jedis.ping());  <span class="comment">//输出PONG表示没有问题</span></span><br><span class="line">    Set&lt;String&gt; res=jedis.keys(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(String str:res)&#123;</span><br><span class="line">        System.out.println(str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-Springboot整合（待看主要是视频的P26、P27）"><a href="#7-Springboot整合（待看主要是视频的P26、P27）" class="headerlink" title="7.Springboot整合（待看主要是视频的P26、P27）"></a>7.Springboot整合（待看主要是视频的P26、P27）</h2><h2 id="8-Redis-conf详解"><a href="#8-Redis-conf详解" class="headerlink" title="8.Redis.conf详解"></a>8.Redis.conf详解</h2><p>启动的时候就通过配置文件来启动</p>
<blockquote>
<p>配置文件 unit单位：对于大小写不敏感</p>
</blockquote>
<blockquote>
<p>包含：相当于导入其他的配置文件</p>
<p>如：include &#x2F;path&#x2F;to&#x2F;local.conf</p>
<p>​		include &#x2F;path&#x2F;to&#x2F;other.conf</p>
</blockquote>
<blockquote>
<ul>
<li>网络<ol>
<li>绑定</li>
</ol>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>快照<ul>
<li>持久化，在规定的时间内，执行了多少次操作，则会持久化到文件，rdb.aof.redis是内存数据库，如果没有持久化，那么数据断电即失。</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果3600秒内，如果至少有一个 key进行了修改，我们即失进行持久化操作</span></span><br><span class="line">save 3600 1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果300秒内，如果至少100个key进行了修改，我们就及时进行持久化操作</span></span><br><span class="line">save 300 100</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果60秒内，如果至少10000个key进行了修改，我们就及时进行持久化操作</span></span><br><span class="line">save 60 10000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们之后学习完持久化，可以进行自己设置</span></span><br><span class="line"></span><br><span class="line">stop-writes-on-bgsave-error yes		#持久化如果出错，是否需要继续工作</span><br><span class="line"></span><br><span class="line">rdbcompression yes					#是否压缩rdb文件，需要消耗一些cpu资源</span><br><span class="line"></span><br><span class="line">rdbchecksum yes						#保存rdb文件的时候，进行错误的检查校验</span><br><span class="line"></span><br><span class="line">dir ./								#指定rdb文件保存的目录</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>REPLICATION复制，后面讲解主从复制的时候会讲解</p>
</blockquote>
<blockquote>
<p>SECURITY安全</p>
</blockquote>
<p>可以再这里设置redis的密码，默认是没有密码</p>
<blockquote>
<p>客户端限制</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">maxclients 10000					#设置能连接的最大客户端数量</span><br><span class="line"></span><br><span class="line">maxmemory &lt;bytes&gt;					#redis配置最大的内存容量</span><br><span class="line"></span><br><span class="line">maxmemory-policy noeviction			#内存满了之后的处置策略</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>APPEND ONLY 模式，aof配置</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">appendonly no						#默认是不开启aof模式的，默认时使用rdb方式持久化的，在大部分所有的的情况下，rdb完全够用</span><br><span class="line"></span><br><span class="line">appendfilename &quot;appendonly.aof&quot;		#持久化文件的名字</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">appendfsync always				<span class="comment">#每次修改丢回sync,消耗性能</span></span></span><br><span class="line">appendfsync everysec				#每秒执行一次sync,可能会丢失这一秒的数据</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">appendfsync no					<span class="comment">#不执行sync,这个时候操作系统自己同步数据，速度最快</span></span></span><br></pre></td></tr></table></figure>

<h2 id="9-Redis持久化"><a href="#9-Redis持久化" class="headerlink" title="9.Redis持久化"></a>9.Redis持久化</h2><p>面试和工作，持久化是重点。Redis是内存数据库，如果不将内存中的数据库状态保存到磁盘，那么一旦服务器进程退出，服务器中的数据库状态也会消失，所以Redis提供了持久化功能。</p>
<h3 id="1-RDB-Redis-DataBase"><a href="#1-RDB-Redis-DataBase" class="headerlink" title="1.RDB(Redis DataBase)"></a>1.RDB(Redis DataBase)</h3><blockquote>
<ul>
<li><p>工作原理：</p>
<p>在指定的时间间隔内，将内存中的数据集快照写入磁盘，也就是行话讲的快照（snapshot）,它恢复时是将快照文件直接读到内存中。</p>
<p>Redis会单独创建（fork）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件，整个过程中，主进程是不进行任何I&#x2F;O操作的，这就确保了极高的性能，如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效，RDB的缺点是最后一次持久化后的数据可能丢失。我们默认的就是RDB，一般请开给你下不需要修改这个配置。</p>
<p><font color='red'>rdb保存的文件是dump.rdb</font>，都是在redis.conf文件中配置的<font color='red'>【在生产环境中我们需要对dump.rdb进行备份，防止丢失】</font></p>
</li>
</ul>
</blockquote>
<p><img src="C:\Users\helloworld\AppData\Roaming\Typora\typora-user-images\image-20211205162549921.png" alt="image-20211205162549921"></p>
<blockquote>
<ul>
<li><font color='red'>触发机制：</font><ol>
<li>save的规则满足的情况下，会自动触发rdb操作</li>
<li>执行flushall命令，也会触发我们的rdb规则</li>
<li>退出redis（如执行shutdown命令的时候）,也会产生rdb文件</li>
</ol>
</li>
</ul>
</blockquote>
<p>备份就自动生成一个dump.rdb文件</p>
<blockquote>
<ul>
<li><p>如何恢复rdb文件</p>
<ol>
<li><p>只需要将rdb文件放在我们的redis启动目录下（在我本机里面是&#x2F;usr&#x2F;local&#x2F;bin目录下）就可以，redis启动的时候会自动检查dump.rdb文件中的数据</p>
</li>
<li><p>查看需要存在的位置</p>
<p>​	127.0.0.1:6379&gt; config get dir</p>
<p>​	1）”dir”</p>
<p>​	2）”&#x2F;usr&#x2F;local&#x2F;bin”		#如果在这个目录下存在dump.rdb文件，启动就自动会恢复其中的文件</p>
</li>
</ol>
</li>
</ul>
</blockquote>
<blockquote>
<p>几乎使用它默认的配置就够用了</p>
</blockquote>
<blockquote>
<ul>
<li><font color='red'>RDB优点：</font><ol>
<li>适合大规模的数据恢复！dump.rdb</li>
<li>对数据完整性要求不高</li>
</ol>
</li>
<li><font color='red'>RDB缺点：</font><ol>
<li>需要一定的时间间隔进程才操作！如果redis意外宕机了，这个最后一次修改的数据就没有了</li>
<li>fork进程的时候，会需要一定的内存空间</li>
</ol>
</li>
</ul>
</blockquote>
<h3 id="2-AOF-Append-Only-File"><a href="#2-AOF-Append-Only-File" class="headerlink" title="2.AOF(Append Only File)"></a>2.AOF(Append Only File)</h3><p>将我们所有的命令都记录下来，history,恢复的时候就把这个文件全部执行一遍</p>
<blockquote>
<ul>
<li><p>AOF是什么：</p>
<p>以日志的形式来记录每个写操作，将Redis执行过的所有指令记录下来（该操作不记录），只许追加文件但不可以改写文件，reds启动之初会读取该文件重新构建数据，换言之，redis重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作</p>
</li>
</ul>
</blockquote>
<p><font color='red'>Aof保存的是appendonly.aof文件</font></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendonly no				#默认是不开启的</span><br></pre></td></tr></table></figure>

<p>默认是不开启的，我们需要手动进行配置，我们只需要将appendonly改为yes就开启了aof</p>
<p>重启之后，redis就可以生效了</p>
<p>如果这个Aof文件有错误，这时候redis是启动不起来的，我们需要修复这个aof文件，redis给我们提供了这样一个工具，redis-check-aof –fix</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这是在aof文件有错误的情况下启动redis失败的情况</span></span><br><span class="line">[root@study bin]# redis-server redis.conf</span><br><span class="line">[root@study bin]# redis-cli</span><br><span class="line">Could not connect to Redis at 127.0.0.1:6379: Connection refused</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##########################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们可以通过redis-check-aof文件来修复appendonly.aof文件，再重新启动redis</span></span><br><span class="line">[root@study bin]# redis-check-aof --fix appendonly.aof </span><br><span class="line">0x              3c: Expected \r\n, got: 6b66</span><br><span class="line">AOF analyzed: size=97, ok_up_to=52, ok_up_to_line=15, diff=45</span><br><span class="line">This will shrink the AOF from 97 bytes, with 45 bytes, to 52 bytes</span><br><span class="line">Continue? [y/N]: y</span><br><span class="line">Successfully truncated AOF</span><br></pre></td></tr></table></figure>

<blockquote>
<p>APPEND ONLY 模式，aof配置</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">appendonly no						#默认是不开启aof模式的，默认时使用rdb方式持久化的，在大部分所有的的情况下，rdb完全够用</span><br><span class="line"></span><br><span class="line">appendfilename &quot;appendonly.aof&quot;		#持久化文件的名字</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">appendfsync always				<span class="comment">#每次修改丢回sync,消耗性能</span></span></span><br><span class="line">appendfsync everysec				#每秒执行一次sync,可能会丢失这一秒的数据</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">appendfsync no					<span class="comment">#不执行sync,这个时候操作系统自己同步数据，速度最快</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">rewrite	重写</span></span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br></pre></td></tr></table></figure>

<blockquote>
<p>重写规则的说明：如果aof文件大于64mb,太大了，就会fork一个新的进程来将我们的文件进行重写</p>
</blockquote>
<blockquote>
<ul>
<li><font color='red'>AOF优点：</font><ol>
<li>每一次修改都同步，文件的完整性会更加好</li>
<li>每秒同步一次，可能会丢失一秒的数据</li>
<li>从不同步，效率最高的</li>
</ol>
</li>
<li><font color='red'>AOF缺点：</font><ol>
<li>相对于数据文件来说，aof文件远远大于rdb,修复的速度也比rdb慢</li>
<li>aof运行效率也比rdb慢，</li>
</ol>
</li>
</ul>
</blockquote>
<h2 id="10-Redis发布订阅"><a href="#10-Redis发布订阅" class="headerlink" title="10.Redis发布订阅"></a>10.Redis发布订阅</h2><blockquote>
<p>Redis发布订阅（pub&#x2F;sub）是一种消息通信模式：发送者（pub）发送消息，订阅者（sub）接收信息。</p>
<p>Redis客户端可以订阅任意数量的频道。（发送者和订阅者都是客户端，服务器端作为队列存储转发信息）</p>
</blockquote>
<blockquote>
<p>测试</p>
</blockquote>
<p><strong>订阅端</strong>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SUBSCRIBE neu				#订阅一个频道</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) &quot;subscribe&quot;</span><br><span class="line">2) &quot;neu&quot;</span><br><span class="line">3) (integer) 1</span><br><span class="line">1) &quot;message&quot;</span><br><span class="line">2) &quot;neu&quot;</span><br><span class="line">3) &quot;hello&quot;</span><br><span class="line">1) &quot;message&quot;</span><br><span class="line">2) &quot;neu&quot;</span><br><span class="line">3) &quot;world&quot;</span><br></pre></td></tr></table></figure>

<p><strong>发送端：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; PUBLISH neu hello			#向一个频道内发送信息</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; PUBLISH neu world			#向一个频道内发送信息</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>原理：<ul>
<li>Pub&#x2F;Sub从字面上理解就是发布（publish）与订阅（Subscribe）,在Redis中，你可以设定对某一个key值（就是一个channel）进行消息发布及消息订阅，当一个key值上进行了消息发布后，所有订阅它的客户端都会收到相应的信息，这一功能最明显的做法就是用作实时消息系统，比如普通的即时聊天，群聊等功能。</li>
</ul>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><p>使用场景：</p>
<ol>
<li>实时消息系统</li>
<li>实时聊天（频道当作聊天室，将消息回显给所有人）</li>
<li>订阅关注系统</li>
</ol>
</li>
<li><p>稍微复杂的我们使用消息中间件来做：如Kafka，rabbitMQ</p>
</li>
</ul>
</blockquote>
<h2 id="11-Redis主从复制"><a href="#11-Redis主从复制" class="headerlink" title="11.Redis主从复制"></a>11.Redis主从复制</h2><blockquote>
<ul>
<li><p>概念：</p>
<ul>
<li><p>主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为主节点（master&#x2F;leader）,后者称为从节点（slave&#x2F;follower）;数据的复制是单向的，只能由主节点到从节点。Master以写为主，salve以读为主。<font color='red'>（这里面的主节点和从节点都是属于Redis-server）</font></p>
</li>
<li><p><font color='red'>默认情况下，每台Redis服务器都是主节点</font>，且一个主节点可以有多个从节点（或没有从节点），但一个从节点只能有一个主节点</p>
</li>
</ul>
</li>
<li><p>主从复制，读写分离！80%的情况都是在进行读操作，减缓服务器的压力架构中经常使用。一主二从</p>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><font color='red'>主从复制的作用：</font><ol>
<li>数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式</li>
<li>故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复，实际上是一种服务的冗余</li>
<li>负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务（即写Redis数据时应用连接主节点，读Redis数据时应用连接从节点），分担服务器负载，尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高Redis服务器的并发量</li>
<li>高可用（集群）的基础：除了上述作用外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是Redis高可用的基础</li>
</ol>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>一般在工程项目中，不要只使用一台Redis（会宕机），原因如下：<ol>
<li>结构上，单个服务器会发生单点故障，并且一台服务器处理所有请求负载，压力过大</li>
<li>从容量上，单个Redis服务器内存容量有限，最好单个Redis服务器最大内存使用量不要超过20G</li>
</ol>
</li>
</ul>
</blockquote>
<blockquote>
<p><font color='red'>环境配置</font></p>
</blockquote>
<p>只用配置从库，不用配置主库，因为默认是主库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@study bin]# redis-cli	</span><br><span class="line">127.0.0.1:6379&gt; INFO replication			#查看当前服务器的主/从复制信息</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replication</span></span><br><span class="line">role:master			#角色 master</span><br><span class="line">connected_slaves:0	#没有从机</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:d6b714e78248b3e0ff79ad463b49eb5a301243fa</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br></pre></td></tr></table></figure>

<blockquote>
<p><font color='red'>步骤（一主二从）：（这是属于单机多集群，因为server都一样，只是配置文件不同，端口不同）</font></p>
<ol>
<li>复制3个配置文件（redis.conf） <ol>
<li>[root@study bin]#  cp redis.conf redis79.conf</li>
<li>[root@study bin]#  cp redis.conf redis80.conf</li>
<li>[root@study bin]#  cp redis.conf redis81.conf</li>
</ol>
</li>
<li>然后修改对应的配置信息：<ol>
<li>端口号：port	&#x3D;&#x3D;6379&#x3D;&#x3D;</li>
<li>修改pid名字：pid_file_name：pidfile &#x2F;var&#x2F;run&#x2F;&#x3D;&#x3D;redis_6381.pid&#x3D;&#x3D;</li>
<li>log文件名字：logfile &#x3D;&#x3D;”6381.log”&#x3D;&#x3D; </li>
<li>备份文件名字：dbfilename &#x3D;&#x3D;dump6381.rdb&#x3D;&#x3D;</li>
</ol>
</li>
<li>修改完毕之后，启动我们的3个redis服务器，可以通过进程信息查询<ol>
<li>[root@study bin]# redis-server redis79.conf</li>
<li>[root@study bin]# redis-server redis80.conf</li>
<li>[root@study bin]# redis-server redis81.conf</li>
<li>[root@study bin]# ps -ef |grep redis<br>root       5244      1  0 20:09 ?        00:00:12 redis-server 127.0.0.1:6379<br>root       5648      1  0 20:36 ?        00:00:00 redis-server 127.0.0.1:6380<br>root       5656      1  1 20:36 ?        00:00:00 redis-server 127.0.0.1:6381<br>root       5662   4080  0 20:36 pts&#x2F;2    00:00:00 grep –color&#x3D;auto redis</li>
</ol>
</li>
<li>在不配置的情况下，每台服务器都是主服务器，开三个端口作为客户端进入<ol>
<li>[root@study bin]# redis-cli -p 6379<br>127.0.0.1:6379&gt;</li>
<li>[root@study bin]# redis-cli -p 6380<br>127.0.0.1:6380&gt; </li>
<li>[root@study bin]# redis-cli -p 6381<br>127.0.0.1:6381&gt;</li>
</ol>
</li>
<li>通过info replication查看会发现每个服务器都是主机，所以一般情况下只用配置从机就可以了。现在准备配置一主（6379）二从（6380，6381）.核心就是从机来认主机<ol>
<li>127.0.0.1:6380&gt; SLAVEOF 127.0.0.1 6379<br>OK</li>
<li>127.0.0.1:6381&gt; SLAVEOF 127.0.0.1 6379<br>OK</li>
</ol>
</li>
</ol>
</blockquote>
<p><font color='red'>#查看配置完从机后的主机主从复制信息：</font></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replication</span></span><br><span class="line">role:master		#角色	master</span><br><span class="line">connected_slaves:2		#从机的个数</span><br><span class="line">slave0:ip=127.0.0.1,port=6380,state=online,offset=84,lag=1	#从机的相关信息</span><br><span class="line">slave1:ip=127.0.0.1,port=6381,state=online,offset=84,lag=1	#从机的相关信息</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:61e4b33ab2f9baa6be68cf635919f485289ce44c</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:98</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:98</span><br></pre></td></tr></table></figure>

<p><font color='red'>#查看配置完从机后的从机主从复制信息：</font></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6381&gt; info replication</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replication</span></span><br><span class="line">role:slave		#角色	slave</span><br><span class="line">master_host:127.0.0.1	#主机的ip</span><br><span class="line">master_port:6379		#主机的端口号</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:9</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_read_repl_offset:42</span><br><span class="line">slave_repl_offset:42</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">replica_announced:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:61e4b33ab2f9baa6be68cf635919f485289ce44c</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:42</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:29</span><br><span class="line">repl_backlog_histlen:14</span><br></pre></td></tr></table></figure>

<p>但应该注意的是真正的主从配置应该在配置文件中（redis.conf）配置，这样的话就是永久的，我们这里使用的是命令，暂时的。</p>
<blockquote>
<p><font color='red'>细节：</font></p>
<ol>
<li>主机可以写，从机不能写只能读！主机中的所有信息和数据，都会自动被从机保存。</li>
<li>当主机宕机后，如果对应的的rdb文件（dump6379.rdb）被移除掉，则主机中的原有数据就都丢失了，没有重新连接的话，从机中原有的数据仍然可用且存在。这时如果再重新连接后，则从机中原有的那部分数据也会丢失（从机中的数据都是来源于主机，所以连接后，只会和主机中的数据一样多）</li>
<li>在主机可用的情况下，如果从机宕机了，这个从机就又变回主机了，所以如果没有重新配置从机（6380这个，即让6380成为6379的从机），此时6380的机子就只有宕机前6379主机的数据，之后主机写入的内容从机（6380）是没有的，但是如果6380经过命令或者配置文件成为6379的从机后，就又拥有了主机6379的全部数据了。</li>
</ol>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">主机6379</span></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty array)</span><br><span class="line">127.0.0.1:6379&gt; set k1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;v1&quot;</span><br><span class="line">127.0.0.1:6379&gt; shutdown		#主机宕机后，从机仍然可用，即可以读数据</span><br><span class="line">not connected&gt; exit</span><br><span class="line"></span><br><span class="line">[root@study bin]# redis-server redis79.conf		#主机重新连接回来后，从机就又可以从主机中获取到信息</span><br><span class="line">[root@study bin]# redis-cli -p 6379</span><br><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:2</span><br><span class="line">slave0:ip=127.0.0.1,port=6380,state=online,offset=14,lag=1</span><br><span class="line">slave1:ip=127.0.0.1,port=6381,state=online,offset=14,lag=0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:c80ec71109519c7d9313d32f3f6e39dec8b99b9f</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:14</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:14</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;k1&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">从机6380</span></span><br><span class="line">127.0.0.1:6380&gt; keys *</span><br><span class="line">(empty array)</span><br><span class="line">127.0.0.1:6380&gt; keys *</span><br><span class="line">1) &quot;k1&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">从机6381</span></span><br><span class="line">127.0.0.1:6381&gt; keys *</span><br><span class="line">1) &quot;k1&quot;</span><br><span class="line">127.0.0.1:6381&gt; set k2 v2</span><br><span class="line">(error) READONLY You can&#x27;t write against a read only replica.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>复制原理：</p>
<ul>
<li>slave启动成功连接到master后会发送一个sync同步命令，</li>
<li>master接到命令，启动后台的存盘进程，同时收集所有接受到的用于修改数据的命令，在后台进程执行完毕之后，<font color='red'>master将传送整个数据文件到slave，并完成一次完全同步</font></li>
<li><font color='red'>全量复制</font>：而slave服务器在接受到数据库文件数据后，将其存盘并加载到内存中</li>
<li><font color='red'>增量复制</font>：Master继续将新的所有收集到的修改命令依次传给slave,完成同步</li>
<li>但是只要是重新连接到master,一次完全同步（全量复制）将会自动执行</li>
</ul>
</blockquote>
<blockquote>
<p>注意：这里面从机作为另一个从机形式上的主机（说是形式上，是因为这个从机仍然不能进行写数据），所以它的角色仍然是从节点（slave）</p>
<p>如6379是主机，连接一个从机6380，这个从机又连接另一个从机6381.。这种方式也可以完成主从复制。</p>
</blockquote>
<blockquote>
<ul>
<li><p>如果主机宕机了，从机可以通过执行命令成为主机.其他节点就可以手动连接到这个新主机了（手动的，哨兵模式是自主的）</p>
<ul>
<li><p>127.0.0.1:6380&gt; slaveof no one</p>
<p>OK</p>
</li>
</ul>
</li>
<li><p>如果这个时候原有的主机重新回来了，也只能重新配置主从机才可以。</p>
</li>
</ul>
</blockquote>
<h2 id="12-哨兵模式"><a href="#12-哨兵模式" class="headerlink" title="12. 哨兵模式"></a>12. 哨兵模式</h2><p>(自主选举老大(主机)的模式)</p>
<blockquote>
<p>概述:</p>
<ul>
<li>主从切换技术的方法是:当主服务器宕机后,需要手动把一台从服务器切换为主服务器,这就需要人工干预,费时费力,还会造成一段时间内服务不可用,这不是一种推荐的方式,更多时候,我们优先考虑哨兵模式,Redis从2.8开始正式提供了Sentinel(哨兵)架构来解决这个问题</li>
<li>前面手动切换的自动版,能够后台自主监控主机是否故障,如果故障了根据投票数自动将从库转为主库</li>
<li><font color='red'>哨兵模式是一种特殊的模式,首先Redis提供了哨兵的命令,哨兵是一个单独的进程,作为进程,它会独立运行,其原理是哨兵通过发送命令,等待Redis服务器响应,从而监控运行的多个Redis实例</font></li>
<li>哨兵进程需要单独开启,就是redis-sentinel,一般情况下,也会配置多个哨兵,防止一个哨兵宕机了导致不可用.</li>
<li>假设主服务器宕机,哨兵1先检测到这个结果,系统并不会马上进行failover过程,仅仅是哨兵1主观的认为主服务器不可用,,这个现象称为<font color='red'>主观下线</font>,当后面的哨兵也检测到主服务器不可用的时候,并且数量达到一定值时,那么哨兵之间就会进行一次投票(这里的投票是指哨兵赞成某一从服务器转化为主服务器,就给他投票),投票的结果由一个哨兵发起,进行<font color='red'>failover故障转移操作</font>,切换成功后,就会通过发布订阅模式,让各个哨兵把自己监控的从服务器实现切换主机,这个过程称为<font color='red'>客观下线</font>.</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>测试:(目前的状态是一主二从)<ol>
<li>新建并配置一个哨兵配置文件<ol>
<li>[root@study bin]# vim sentinel.conf</li>
<li>配置文件中的内容:      sentinel monitor myredis 127.0.0.1 6379 1</li>
</ol>
</li>
<li>启动哨兵<ol>
<li>[root@study bin]# redis-sentinel sentinel.conf</li>
</ol>
</li>
</ol>
</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sentinel monitor 被监控的名称 host port 1</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">后面这个数字1,代表主机挂了,slave投票看让谁接替成为主机,投票最多的,就会成为主机</span></span><br><span class="line">sentinel monitor myredis 127.0.0.1 6379 1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果Master节点断开了，这个时候就会从从机中随机选择一个服务器进行投票！（这里面有一个投票算法）</p>
<ul>
<li>当主机宕机或者断开后，选出一个从机成为主机后，原来其他的从机就也会选择这个新主机成为主机，并且宕机或者断开的那个主机也是会被配置为这个新主机的从机</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><p>哨兵模式优点：</p>
<ol>
<li>哨兵集群，基于主从复制模式，所有的主从配置优点，它全有。</li>
<li>主从可以切换，故障可以转移，系统的可用性更好</li>
<li>哨兵模式就是主从模式的升级，手动到自动，更加高级</li>
</ol>
</li>
<li><p>哨兵模式缺点：</p>
<ol>
<li>Redis不好在线扩容的，集群容量一旦达到上限，在线扩容就十分麻烦</li>
<li>实现哨兵模式的配置其实是很麻烦的，里面有很多选择</li>
</ol>
</li>
</ul>
</blockquote>
<h2 id="13-Redis缓存穿透和雪崩（面试高频，工作常用）"><a href="#13-Redis缓存穿透和雪崩（面试高频，工作常用）" class="headerlink" title="13.Redis缓存穿透和雪崩（面试高频，工作常用）"></a>13.Redis缓存穿透和雪崩（面试高频，工作常用）</h2><blockquote>
<p>这三个都涉及到服务的高可用问题</p>
</blockquote>
<h3 id="1-缓存穿透-根源-是因为查不到"><a href="#1-缓存穿透-根源-是因为查不到" class="headerlink" title="1.缓存穿透(根源:是因为查不到)"></a>1.缓存穿透(根源:是因为查不到)</h3><blockquote>
<ul>
<li><p>概念：</p>
<p>缓存穿透的概念很简单，用户想要查询一个数据，发现Redis内存数据库没有，也就是缓存没有命中，于是向持久层数据库（如MySql）查询，发现也没有，于是本次查询失败，当用户很多的时候，缓存都没有命中，于是都去请求了持久层数据库，这会给持久层数据库造成很大的压力，这时候就相当于出现了缓存穿透。</p>
<ul>
<li><p>解决方案：</p>
<p><font color='red'>布隆过滤器</font>：布隆过滤器是一种数据结构，对所有可能查询的参数以hash形式存储，在控制层先进行校验，不符合则丢弃，从而避免了对底层存储系统的查询压力</p>
<p><font color='red'>缓存空对象</font>：当存储层不命中后，即使返回的是空对象也将其缓存起来，同时设置一个过期时间，之后再访问这个数据的时候就会从缓存中获取，保护了后端数据源.但是这个方法存在两个问题:</p>
<ol>
<li>如果空值能够被存储起来,这就意味着需要更多的空间存储更多的键,因为这当中可能会有很多的空值的键</li>
<li>即使对空值设置了过期时间,还是会存在缓存层和存储层的数据会有一段时间窗口的不一致,这对于需要保持一致性的业务会有影响.</li>
</ol>
</li>
</ul>
</li>
</ul>
<p>						</p>
</blockquote>
<h3 id="2-缓存击穿-根源-是因为查询过多-缓存过期"><a href="#2-缓存击穿-根源-是因为查询过多-缓存过期" class="headerlink" title="2.缓存击穿(根源:是因为查询过多,缓存过期)"></a>2.缓存击穿(根源:是因为查询过多,缓存过期)</h3><blockquote>
<ul>
<li><p>概念:</p>
<p>这里需要注意和缓存击穿的区别,缓存击穿,是指一个key非常热点,在不停的扛着高并发,大并发集中对这一个点进行访问,当这个key在失效的瞬间,持续的大并发就穿透缓存,就像在一个屏幕上凿开了一个洞.</p>
<p>当某个key在过期的瞬间,有大量的请求并发访问,这类数据一般是热点数据,由于缓存过期,会同时访问数据库来查询最新数据,并且同时回写缓存,会导致数据库瞬间压力过大.</p>
</li>
<li><p>解决方案:</p>
<ul>
<li><p><font color='red'>设置热点数据永不过期,</font>从缓存层面来看,没有设置过期时间,所以不会出现热点key过期后产生的问题</p>
</li>
<li><p><font color='red'>加互斥锁</font>.分布式锁,使用分布式锁,保证对于每个key同时只有一个线程去查询后端服务,其他线程没有获得分布式锁的权限,因此只需要等待即可,这种方式将高并发的压力转移到了分布式锁,因此对分布式锁的考研很大.</p>
</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="3-缓存雪崩"><a href="#3-缓存雪崩" class="headerlink" title="3.缓存雪崩"></a>3.缓存雪崩</h3><blockquote>
<ul>
<li><p>概念:</p>
<p>缓存雪崩,是指在某一个时间段,缓存集中过期失效&#x2F;Redis宕机</p>
<p>产生雪崩的原因之一,比如在写文本的时候,马上就要到双十二零点,很快就会迎来一波抢购,这波商品时间比较集中的放入了缓存,假设缓存了一个小时,那么到了凌晨一点的时候,这批商品的缓存就都过期了,而对这批商品的访问查询,都落到了数据库上,对于数据库而言,就会产生周期性的压力波峰,于是所有的请求都会到达存储层,存储层的调用量会暴增,造成存储层也会挂掉的情况</p>
<p>其实集中过期,倒不是非常致命,比较致命的缓存雪崩是由于缓存服务器某个节点宕机或断网,因为自然形成的缓存雪崩,一定是在某个事件段集中创建缓存,这个时候,数据库也是可以顶住压力的,无非是对数据库产生周期性的压力而已.而缓存服务器节点的宕机,对数据库服务器造成的压力是不可预知的,很有可能瞬间就把数据库压垮.</p>
</li>
<li><p>解决方案:</p>
<ul>
<li>redis高可用:这个思想的含义就是,既然一台redis有可能断掉,那我多增设几台redis,这样一台挂掉之后其他的还可以继续工作,其实就是搭建的集群(异地多活.)</li>
<li>限流降级:思想就是在缓存失效后,通过加锁或者队列来控制数据库写缓存的线程数量,比如对某个key,只允许一个线程查询数据和写缓存,其他线程等待.</li>
<li>数据预热:数据加热的含义就是在正式部署之前,我先把可能的数据预先访问一遍,这样部分可能大量访问的数据就会加载到缓存中,在即将发生大并发访问前手动触发加载不同的key,设置不同的过期时间,让缓存失效的时间尽量均匀.</li>
</ul>
</li>
</ul>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kdhello07.github.io/2022/10/27/Redis%E7%AC%94%E8%AE%B0/" data-id="clrv2tqxj00094hku0vh2cmi8" data-title="Redis学习" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/10/27/Linux%E5%AD%A6%E4%B9%A0/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          Linux学习
        
      </div>
    </a>
  
  
    <a href="/2022/08/27/Java%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3%E7%AC%94%E8%AE%B0/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">Java编程思想</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/">技术学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8B%E8%AF%95/">测试</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go/" rel="tag">Go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AA%E4%BA%BA/" rel="tag">个人</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" rel="tag">云原生</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91/" rel="tag">并发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/" rel="tag">快捷键</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag">操作系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag">测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Go/" style="font-size: 13.33px;">Go</a> <a href="/tags/JVM/" style="font-size: 13.33px;">JVM</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Linux/" style="font-size: 13.33px;">Linux</a> <a href="/tags/MySQL/" style="font-size: 13.33px;">MySQL</a> <a href="/tags/Redis/" style="font-size: 13.33px;">Redis</a> <a href="/tags/docker/" style="font-size: 13.33px;">docker</a> <a href="/tags/git/" style="font-size: 13.33px;">git</a> <a href="/tags/%E4%B8%AA%E4%BA%BA/" style="font-size: 13.33px;">个人</a> <a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 13.33px;">云原生</a> <a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 13.33px;">并发</a> <a href="/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/" style="font-size: 13.33px;">快捷键</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 13.33px;">操作系统</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 16.67px;">数据库</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">测试</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 13.33px;">算法</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/01/27/Mac%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/">Mac使用技巧</a>
          </li>
        
          <li>
            <a href="/2024/01/26/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2022/12/27/Java%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/">Java语言学习</a>
          </li>
        
          <li>
            <a href="/2022/10/27/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/">Java虚拟机学习</a>
          </li>
        
          <li>
            <a href="/2022/10/27/leetcode%E7%AC%94%E8%AE%B0/">LeetCode刷题</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Kevin he<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>